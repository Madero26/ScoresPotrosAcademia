<!-- TOPBAR -->
<header class="topbar">
  <div class="topbar__container">
    <div class="topbar__left">
      <img class="brand" src="/resources/imgs/potros.png" alt="Potros ITSON">
      <span class="title">Panel administrativo</span>
    </div>
    <div class="topbar__right">
      <% if (usuario) { %>
        <span class="user">Usuario: <strong>
            <%= usuario.usuario %>
          </strong></span>
        <script>
          window.__currentUser = {
            id: <%= Number(usuario.id_usuario || 0) %>,
            rol: '<%= String(usuario.rol || "").toUpperCase() %>'
          };
        </script>
        <% } %>
          <a href="/AdminContra" class="btn btn-outline">Cambiar contraseña</a>
          <a href="/logout" class="btn btn-danger">Cerrar sesión</a>
    </div>
  </div>
</header>

<!-- ACCIONES -->
<nav class="actions">
  <div class="actions__container">
    <div class="actions__grid">

      <!-- CREAR -->
      <div class="action">
        <label for="adm-crear">Crear</label>
        <select id="adm-crear" class="select" onchange="redirigirAdminGeneral(this)">
          <option>CREAR</option>

          <optgroup label="Básicos">
            <option value="/formCrearTemporada">Crear temporada</option>
            <option value="/formCrearCategoria">Crear categoría</option>
            <option value="/formCrearJugador">Crear jugador</option>
            <option value="/formCrearEntrenador">Crear entrenador</option>
            <option value="/formCrearCoordinador">Crear coordinador</option>
            <option value="/formCrearEquipoBase">Crear equipo (catálogo)</option>
          </optgroup>

          <optgroup label="Usuarios">
            <option value="/formCrearUsuario">Crear usuario</option>
          </optgroup>

          <optgroup label="Mediciones">
            <option value="/CoordRegistrarRendimiento">Registrar rendimiento mensual</option>
          </optgroup>

          <optgroup label="Gestión por temporada">
            <option value="/formCrearCategoriaTemporada">Registrar categoria en temporada</option>
            <option value="/formCrearEquipoTemporada">Registrar equipo en temporada</option>
            <option value="/formAsignarCoordinadorCategoria">Asignar coordinador a categoría (temporada)</option>
            <option value="/formAsignarJugadorCategoria">Asignar jugador a categoría (temporada)</option>
            <option value="/formInscribirJugadorEquipo">Inscribir jugador en equipo (temporada)</option>
            <option value="/formAsignarUsuarioRolAlias">Asignar rol y alias a usuario en categoría (temporada)</option>
          </optgroup>

          <optgroup label="Controles de temporada">

            <option value="/formCrearMinimoApariciones">Configurar mínimo de apariciones de bateo (temporada)</option>
          </optgroup>

          <optgroup label="Estadísticas (general)">
            <option value="/formStatsCargarBateoEquipo">Cargar bateo por equipo</option>
            <option value="/formStatsCargarPitcheoEquipo">Cargar pitcheo por equipo</option>
            <option value="/formStatsCargarEstadisticaEquipo">Cargar estadísticas del equipo</option>
          </optgroup>


        </select>
      </div>

      <!-- GESTIONAR -->
      <div class="action">
        <label for="adm-gestionar">Gestionar</label>
        <select id="adm-gestionar" class="select" onchange="redirigirAdminGeneral(this)">
          <option>GESTIONAR</option>

          <optgroup label="Básicos">
            <option value="/formActualizarTemporada">Temporadas</option>
            <option value="/formActualizarCategoria">Categorías</option>
            <option value="/formActualizarJugador">Jugadores</option>
            <option value="/formActualizarEntrenador">Entrenadores</option>
            <option value="/formActualizarCoordinador">Coordinadores</option>
            <option value="/formActualizarEquipoBase">Equipos (catálogo)</option>
          </optgroup>

          <optgroup label="Usuarios">
            <option value="/formActualizarUsuario">Usuarios del panel</option>
          </optgroup>

          <optgroup label="Gestión por temporada">
            <option value="/formActualizarCategoriaTemporada">Categorias en temporada</option>
            <option value="/formActualizarEquipoTemporada">Equipos en temporada</option>
            <option value="/formActualizarAsignacionCoordinadorCategoria">Coordinador por categoría</option>
            <option value="/formActualizarAsignacionJugadorCategoria">Jugador por categoría</option>
            <option value="/formActualizarInscripcionJugadorEquipo">Inscripción jugador a equipo</option>
            <option value="/formActualizarUsuarioRolAlias">Rol y alias de usuario</option>
          </optgroup>

          <optgroup label="Controles de temporada">
            <option value="/formActualizarRangoEdad">Rango de nacimiento por categoría</option>
            <option value="/formActualizarMinimoApariciones">Mínimo de apariciones de bateo</option>
          </optgroup>

          <optgroup label="Estadísticas (solo edición)">
            <option value="/formStatsEditarBateoJugador">Editar bateo de jugador</option>
            <option value="/formStatsEditarPitcheoJugador">Editar pitcheo de jugador</option>
            <option value="/formStatsEditarEstadisticaEquipo">Editar estadísticas del equipo</option>
            <option value="/formActualizarEstadisticasRendimiento">Rendimiento</option>
          </optgroup>
        </select>
      </div>

    </div>
  </div>
</nav>

<script>
  if (!window.__adminGeneralNavInitV3) {
    window.__adminGeneralNavInitV3 = true;
    window.redirigirAdminGeneral = function (select) {
      let url = select.value;
      if (url && !/^(CREAR|GESTIONAR)$/.test(url)) {
        if (!url.startsWith('/adminGeneral')) url = '/adminGeneral' + url;
        location.href = url;
      }
      setTimeout(() => (select.selectedIndex = 0), 200);
    };
  }
</script>