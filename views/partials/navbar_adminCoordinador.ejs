<!-- TOPBAR -->
<header class="topbar">
  <div class="topbar__container">
    <div class="topbar__left">
      <img class="brand" src="/resources/imgs/potros.png" alt="Potros ITSON">
      <span class="title">Panel de coordinador</span>
    </div>
    <div class="topbar__right">
      <% if (usuario) { %>
        <span class="user">
          Usuario:
          <strong>
            <%= usuario.alias || usuario.usuario %>
          </strong>
        </span>

        <script>
          window.__currentUser = {
            id: Number('<%= usuario.id_usuario || 0 %>'),
            rol: 'COORDINADOR'
          };
        </script>
        <% } %>


          <a href="/AdminContra" class="btn btn-outline">Cambiar contraseña</a>
          <a href="/logout" class="btn btn-danger">Cerrar sesión</a>
    </div>
  </div>
</header>

<!-- ACCIONES -->
<nav class="actions">
  <div class="actions__container">
    <div class="actions__grid">

      <!-- CREAR -->
      <div class="action">
        <label for="coord-crear">Crear</label>
        <select id="coord-crear" class="select" onchange="redirigirCoord(this)">
          <option>CREAR</option>

          <optgroup label="Personas">
            <option value="/CoordCrearJugador">Crear jugador</option>
            <option value="/CoordCrearEntrenador">Crear entrenador</option>
          </optgroup>

          <optgroup label="Gestión de temporada (mi categoría)">
            <option value="/CoordRegistrarEquipoTemporada">Registrar equipo en temporada</option>
            <option value="/CoordAsignarJugadorCategoria">Asignar jugador a mi categoría</option>
            <option value="/CoordInscribirJugadorEquipo">Inscribir jugador en equipo</option>
          </optgroup>

          <optgroup label="Mediciones">
            <option value="/CoordRegistrarRendimiento">Registrar rendimiento mensual</option>
          </optgroup>
        </select>
      </div>

      <!-- GESTIONAR -->
      <div class="action">
        <label for="coord-gestionar">Gestionar</label>
        <select id="coord-gestionar" class="select" onchange="redirigirCoord(this)">
          <option>GESTIONAR</option>

          <!-- PERSONAS -->
          <optgroup label="Personas">
            <option value="/CoordGestionarJugador">Jugadores</option>
            <option value="/CoordGestionarEntrenador">Entrenadores</option>
          </optgroup>

          <!-- GESTIÓN TEMPORADA (mi categoría) -->
          <optgroup label="Gestión de temporada (mi categoría)">
            <option value="/CoordGestionarEquipoTemporada">Equipos en temporada</option>
            <option value="/CoordGestionarInscripcionJugadorEquipo">
              Inscripción jugador a equipo
            </option>
            
          </optgroup>

          <!-- ESTADÍSTICAS (mi categoría) -->
          <optgroup label="Estadísticas (mi categoría)">
            <option value="/CoordGestionarEstadisticasBateo">Estadísticas de bateo</option>
            <option value="/CoordGestionarEstadisticasPitcheo">Estadísticas de pitcheo</option>
            <option value="/CoordGestionarEstadisticasEquipo">Estadísticas de equipo</option>
            <option value="/CoordGestionarRendimiento">Rendimiento mensual</option>
          </optgroup>
        </select>
      </div>

    </div>
  </div>
</nav>

<script>
  if (!window.__coordNavInitV3) {
    window.__coordNavInitV3 = true;
    window.redirigirCoord = function (select) {
      let url = select.value;
      if (url && !/^(CREAR|GESTIONAR)$/.test(url)) {
        const base = '/adminCoordinador'; // NUEVO PREFIJO
        if (!url.startsWith(base)) url = base + url;
        location.href = url;
      }
      setTimeout(() => (select.selectedIndex = 0), 200);
    };
  }
</script>
