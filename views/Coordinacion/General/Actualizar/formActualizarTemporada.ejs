<!-- views/Coordinacion/General/Actualizar/formActualizarTemporada.ejs -->
<!doctype html><html lang="es"><head>
  <%- include('../../../partials/headAdmin') %>
  <link rel="stylesheet" href="/resources/styles/styleFormsAdmins.css">
</head><body>
  <%- include('../../../partials/navbar_adminGeneral') %>

  <main class="container">
    <h1>Actualizar temporada</h1>

    <div class="card">
      <form id="formSel" method="GET" action="/adminGeneral/formActualizarTemporada" class="form-group" style="margin-bottom:1rem">
        <label>Selecciona temporada</label>
        <select class="input" name="id" onchange="document.getElementById('formSel').submit()">
          <% const lista = Array.isArray(temporadas) ? temporadas : []; %>
          <% lista.forEach(x => { %>
            <option value="<%= x.id_temporada %>" <%= (temporada && x.id_temporada===temporada.id_temporada)?'selected':'' %>><%= x.nombre %></option>
          <% }) %>
        </select>
      </form>

      <% const t = (typeof temporada !== 'undefined' && temporada) ? temporada : null; %>
      <% if (!t) { %>
        <p>No se encontró la temporada seleccionada.</p>
      <% } else { %>

      <form action="/adminGeneral/temporadas/<%= t.id_temporada %>" method="POST" onsubmit="return validarFechas()">
        <div class="form-grid">
          <div class="form-group">
            <label>Nombre *</label>
            <input class="input" type="text" name="nombre" required maxlength="100" value="<%= t.nombre %>">
          </div>

          <div class="form-group">
            <label>Fecha inicio *</label>
            <input class="input" type="date" name="fecha_inicio" required value="<%= (''+t.fecha_inicio).slice(0,10) %>">
          </div>

          <div class="form-group">
            <label>Fecha fin *</label>
            <input class="input" type="date" name="fecha_fin" required value="<%= (''+t.fecha_fin).slice(0,10) %>">
          </div>

          <div class="form-group">
            <label>Fecha corte de edad *</label>
            <input class="input" type="date" name="fecha_corte_edad" required value="<%= (''+t.fecha_corte_edad).slice(0,10) %>">
          </div>

          <label class="switch-row">
            <input type="checkbox" name="is_activa" value="1" <%= Number(t.is_activa)===1?'checked':'' %>>
            <span>Marcar como temporada activa</span>
          </label>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Actualizar</button>
          <a href="/adminGeneral/inicio" class="btn btn-outline">Cancelar</a>
        </div>
      </form>

      <div class="form-actions" style="margin-top:1rem; display:flex; gap:.5rem">
        <form action="/adminGeneral/temporadas/<%= t.id_temporada %>/activar" method="POST">
          <button type="submit" class="btn btn-outline">Marcar activa</button>
        </form>
        <form action="/adminGeneral/temporadas/<%= t.id_temporada %>/eliminar" method="POST" onsubmit="return confirm('¿Eliminar definitivamente esta temporada?')">
          <button type="submit" class="btn btn-danger">Eliminar</button>
        </form>
      </div>

      <% } %>
    </div>
  </main>

  <script>
    function validarFechas() {
      const fi = new Date(document.querySelector('[name="fecha_inicio"]').value);
      const ff = new Date(document.querySelector('[name="fecha_fin"]').value);
      const fc = new Date(document.querySelector('[name="fecha_corte_edad"]').value);
      if (ff < fi) { alert('La fecha fin no puede ser menor a inicio.'); return false; }
      if (fc > fi) { alert('La fecha de corte debe ser <= al inicio.'); return false; }
      return true;
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <% if (typeof alert !== 'undefined' && alert) { %>
  <script>
    Swal.fire({
      title: <%- JSON.stringify(alertTitle) %>,
      text: <%- JSON.stringify(alertMessage) %>,
      icon: <%- JSON.stringify(alertIcon) %>,
      showConfirmButton: <%- JSON.stringify(showConfirmButton) %>,
      timer: <%- (timer==null?'null':Number(timer)) %>
    }).then(()=>{ window.location = <%- JSON.stringify(ruta || ('/adminGeneral/formActualizarTemporada?id=' + (t ? t.id_temporada : ''))) %>; });
  </script>
  <% } %>
</body></html>



